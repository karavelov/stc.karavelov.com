{% extends 'base.html' %}
{% block content %}
{% if request.user.is_superuser %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    /* Loader —Å—Ç–∏–ª */
    #loader {
        display: none;
        margin: 20px auto;
        border: 8px solid #f3f3f3;
        border-radius: 50%;
        border-top: 8px solid #3498db;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<div class="row">
    <div class="col-md-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">–ê—Ä—Ö–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏</h4>
                <hr>

                {% include 'includes/messages.html' %}

                {% if error %}
                    <div class="alert alert-danger text-center">
                        {{ error }}
                    </div>
                {% endif %}

                <div id="infoMessage" class="alert alert-info text-center">
                    ‚ö†Ô∏è –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ—Ç–æ –Ω–∞ –∞—Ä—Ö–∏–≤ –º–æ–∂–µ –¥–∞ –æ—Ç–Ω–µ–º–µ –≤—Ä–µ–º–µ –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–∞ –∑–∞–±–∞–≤–∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∞.
                </div>

                <div id="loader"></div>

                <div class="text-center mt-4">
                    <form method="POST" id="backupForm">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary" id="generateButton">
                            üîÑ –ì–µ–Ω–µ—Ä–∏—Ä–∞–π SQL –±–µ–∫—ä–ø –∏ –∞—Ä—Ö–∏–≤–∏—Ä–∞–π –≤ ZIP
                        </button>
                    </form>
                </div>

                {% if backup_file %}
                    <div id="downloadSection" class="alert alert-success text-center mt-4">
                        ‚úÖ –ë–µ–∫—ä–ø—ä—Ç –µ —É—Å–ø–µ—à–Ω–æ —Å—ä–∑–¥–∞–¥–µ–Ω!
                        <br>
                        <a href="{{ backup_file }}" class="btn btn-success mt-3">‚¨áÔ∏è –°–≤–∞–ª–∏ ZIP –∞—Ä—Ö–∏–≤–∞</a>
                    </div>
                {% else %}
                    <div id="downloadSection" style="display: none;"></div>
                {% endif %}

            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#backupForm').submit(function() {
            $('#generateButton').prop('disabled', true).text('‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ...');
            $('#loader').show();
            $('#infoMessage').text('‚è≥ –ú–æ–ª—è, –∏–∑—á–∞–∫–∞–π—Ç–µ... –ë–µ–∫—ä–ø—ä—Ç —Å–µ —Å—ä–∑–¥–∞–≤–∞.');
        });
    });
</script>

{% else %}
<div class="alert alert-danger text-center">
    ‚ùå –ù—è–º–∞—Ç–µ –¥–æ—Å—Ç—ä–ø –¥–æ —Ç–∞–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞.
</div>
{% endif %}
{% endblock %}
